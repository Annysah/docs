---
title: Webhooks
html_title: Webhooks
description: Webhooks augment the data available to certificate templates
---

Administrators can attach webhooks to provisioners to retrieve additional data that will be available when rendering [certificate templates](/docs/step-ca/templates).

```bash
step ca provisioner webhook add my_provisioner my_webhook --url https://example.com
```

## Webhook Response

The webhook must include `"allow": true` in the response body or step-ca will refuse to sign the certificate request.

step-ca will augment the template data context with whatever is returned from the webhook server in the `data` field of the response body.
For example, a webhook could send the following json response:
```json
{
  "allow": true,
  "data": {
    "role": "eng"
  }
}
```

A template on the provisioner will then be able to reference the response under the path `.Webhooks.webhook_name`.
If the webhook was named `people`, the role in the webhook response could be accessed in a template under the field `.Webhooks.people.role`.

## Requests

All requests will use the POST method to send a json body to the webhook server containing a `timestamp` field.
Additional data will vary based on the type of the certificate being signed.
Refer to the [webhooks server example repository](https://github.com/smallstep/webhooks) for examples in Go of parsing webhook request bodies for both x509 and SSH certificate requests.

### X509 Request Body

For x509 certificates step-ca will include an `x509CertificateRequest` field that will hold a [json representation of the request](https://pkg.go.dev/go.step.sm/crypto@v0.23.1/x509util#CertificateRequest) using the same schema as [x509 template functions](https://smallstep.com/docs/step-ca/templates/#x509-templates) with a [few extra fields](https://github.com/smallstep/certificates/blob/c169defc73db6ba4b83e1acd5bd31feafb4df050/webhook/types.go#L19-L22).
When used with the [acme provisioner](https://smallstep.com/docs/step-ca/provisioners#acme) and the `device-attest-01` challenge, the request body will also contain the verified device ID in the `attestationData.permanentIdentifier` field.

### SSH Request Body

For ssh certificates step-ca will include an `sshCertificateRequest` field with [data from the request](https://github.com/smallstep/certificates/blob/c169defc73db6ba4b83e1acd5bd31feafb4df050/webhook/types.go#L37).


### Authentication

The webhook server must authenticate step-ca before responding with data.

#### Signature

Every webhook has a unique secret that will be displayed when the webhook is created with `step ca provisioner webhook add`.
step-ca will include a signature of the payload in the X-Smallstep-Signature header.
The webhook ID will also be included in the X-Smallstep-Webhook-ID header to help associate the correct signing secret with the webhook request.
Webhook servers must compute an HMAC with the SHA256 hash function using the webhook signing secret as the key and the request body as the message.
See the [webhook server example repository](https://github.com/smallstep/webhooks) for an example of verifying the signature.

#### Authorization Header

For an additional layer of security, step-ca may be configured to send either a bearer token or a username:password in the Authorization header.

```
step ca provisioner webhook update my_provisioner my_webhook --bearer-token=abc123xyz
```

or for basic authentication:

```
step ca provisioner webhook update my_provisioner my_webhook --basic-auth-username user --basic-auth-password pass
```

#### TLS Client Certificate Authentication

By default step-ca will send the authority's leaf certificate when the webhook server requests a client certificate.
This behavior can be disabled:

```
step ca provisioner webhook update my_webhook --provisioner my_provision --disable-tls-client-auth
```
